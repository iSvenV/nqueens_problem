<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>N-Queens Problem</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      background: linear-gradient(to top, #fbb1c6, #80c1e3);
      background-repeat: no-repeat;
      background-attachment: fixed;
      text-align: center;
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    h1 {
      color: white;
      margin-bottom: 10px;
    }
    p, label {
      color: white;
    }
    input, button, span {
      font-size: 16px;
      margin: 10px;
    }
    .board {
      margin: 20px auto;
      display: grid;
    }
    .cell {
      width: 60px;
      height: 60px;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: background-color 0.2s;
      cursor: pointer;
    }
    .cell img {
      width: 100%;
      height: 100%;
      pointer-events: none;
    }
    .controls, .speed-controls, .message {
      margin: 10px;
    }
  </style>
</head>
<body>
  <div id="app"></div>
  
  <script>
    let n = 0;                  
    let initialState = [];      
    let finalState = null;      
    let fixed = [];             
    let cells = [];            
    let delay = 300;           
    let paused = false;              
    
    function clearApp() {
      document.getElementById("app").innerHTML = "";
    }
    
    function createElement(tag, text, className) {
      const el = document.createElement(tag);
      if (text) el.innerText = text;
      if (className) el.className = className;
      return el;
    }
    
    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }
    
    async function sleepWithPause(ms) {
      let elapsed = 0;
      while (elapsed < ms) {
        if (paused) {
          await sleep(50);
        } else {
          const delta = Math.min(50, ms - elapsed);
          await sleep(delta);
          elapsed += delta;
        }
      }
    }
    
    //pause/Resume button
    function togglePause() {
      paused = !paused;
      const pauseButton = document.getElementById("pauseButton");
      if (pauseButton) {
        pauseButton.textContent = paused ? "Resume" : "Pause";
      }
    }
    
    function stateIsValid(state) {
      for (let i = 0; i < state.length; i++) {
        if (state[i] === -1) continue;
        for (let j = i + 1; j < state.length; j++) {
          if (state[j] === -1) continue;
          if (state[i] === state[j] || Math.abs(state[i] - state[j]) === Math.abs(i - j))
            return false;
        }
      }
      return true;
    }
    
    function stateIsComplete(state) {
      return state.every(val => val !== -1);
    }
    
    function arraysEqual(a, b) {
      if (a.length !== b.length) return false;
      for (let i = 0; i < a.length; i++) {
        if (a[i] !== b[i]) return false;
      }
      return true;
    }
    
    function isSafe(state, row, col) {
      for (let i = 0; i < row; i++) {
        if (state[i] === col || Math.abs(state[i] - col) === Math.abs(i - row))
          return false;
      }
      return true;
    }
    
    function page1_initialN() {
      clearApp();
      const app = document.getElementById("app");
      app.appendChild(createElement("h1", "1. Initial State"));
      app.appendChild(createElement("p", "Enter board size N."));
      
      const controlsDiv = document.createElement("div");
      controlsDiv.className = "controls";
      
      const nInput = document.createElement("input");
      nInput.type = "number";
      nInput.placeholder = "Enter N";
      nInput.min = "1";
      nInput.value = "8";  
      controlsDiv.appendChild(nInput);
      
      const createBtn = document.createElement("button");
      createBtn.innerText = "Create Board";
      createBtn.onclick = function() {
        const N = parseInt(nInput.value);
        if (isNaN(N) || N <= 0) {
          alert("Please enter a valid number greater than 0.");
          return;
        }
        n = N;
        initialState = new Array(N).fill(-1);
        fixed = new Array(N).fill(false); 
        page2_initialSetup();
      };
      controlsDiv.appendChild(createBtn);
      app.appendChild(controlsDiv);
      
      app.appendChild(createElement("div", "", "message"));
    }
    
    function page2_initialSetup() {
      clearApp();
      const app = document.getElementById("app");
      app.appendChild(createElement("h1", "1. Initial State"));
      app.appendChild(createElement("p", "click on squares to place/remove a queen (maximum 1 queen per row)."));
      
      const boardDiv = document.createElement("div");
      boardDiv.id = "boardContainer";
      app.appendChild(boardDiv);
      
      createBoard(n);
      updateBoardDisplay(initialState);
      
      for (let r = 0; r < n; r++) {
        for (let c = 0; c < n; c++) {
          cells[r][c].onclick = function() {
            if (initialState[r] === c) {
              initialState[r] = -1;
            } else {
              initialState[r] = c;
            }
            updateBoardDisplay(initialState);
          };
        }
      }
      
      const setInitialBtn = document.createElement("button");
      setInitialBtn.innerText = "Set Initial State";
      setInitialBtn.onclick = function() {
        if (!stateIsValid(initialState)) {
          alert("Invalid configuration: Some queens are threatening each other.");
          return;
        }
        page3_finalSetup();
      };
      app.appendChild(setInitialBtn);
      
      const backBtn = document.createElement("button");
      backBtn.innerText = "Back";
      backBtn.onclick = page1_initialN;
      app.appendChild(backBtn);
    }
    
    function page3_finalSetup() {
      clearApp();
      const app = document.getElementById("app");
      app.appendChild(createElement("h1", "2. Final State"));
      app.appendChild(createElement("p", "Place one queen per row (no conflicts allowed)."));
      
      finalState = new Array(n).fill(-1);
      
      const boardDiv = document.createElement("div");
      boardDiv.id = "boardContainer";
      app.appendChild(boardDiv);
      
      createBoard(n);
      updateBoardDisplay(finalState);
      
      for (let r = 0; r < n; r++) {
        for (let c = 0; c < n; c++) {
          cells[r][c].onclick = function() {
            if (finalState[r] === c) {
              finalState[r] = -1;
            } else {
              finalState[r] = c;
            }
            updateBoardDisplay(finalState);
          };
        }
      }
      
      const setFinalBtn = document.createElement("button");
      setFinalBtn.innerText = "Set Final State";
      setFinalBtn.onclick = function() {
        if (!stateIsComplete(finalState)) {
          alert("Please place exactly one queen per row.");
          return;
        }
        if (!stateIsValid(finalState)) {
          alert("Invalid final state: Some queens are threatening each other.");
          return;
        }
        page4_solution();
      };
      
      const noFinalBtn = document.createElement("button");
      noFinalBtn.innerText = "No Final State";
      noFinalBtn.onclick = function() {
        finalState = null;
        page4_solution();
      };
      
      app.appendChild(setFinalBtn);
      app.appendChild(noFinalBtn);
      
      const backBtn = document.createElement("button");
      backBtn.innerText = "Back";
      backBtn.onclick = page2_initialSetup;
      app.appendChild(backBtn);
    }
    
    function page4_solution() {
      clearApp();
      const app = document.getElementById("app");
      app.appendChild(createElement("h1", "Solving Process"));
      
      const speedDiv = document.createElement("div");
      speedDiv.className = "speed-controls";
      
      const speedLabel = createElement("label", "Speed: ");
      speedLabel.htmlFor = "speedSlider";
      speedDiv.appendChild(speedLabel);
      
      const speedSlider = document.createElement("input");
      speedSlider.type = "range";
      speedSlider.id = "speedSlider";
      speedSlider.min = "1";
      speedSlider.max = "10";
      speedSlider.value = "5";
      speedSlider.step = "1";
      speedDiv.appendChild(speedSlider);
      
      const speedValue = createElement("span", "5");
      speedValue.id = "speedValue";
      speedDiv.appendChild(speedValue);
      
      const pauseBtn = document.createElement("button");
      pauseBtn.id = "pauseButton";
      pauseBtn.innerText = "Pause";
      pauseBtn.onclick = togglePause;
      speedDiv.appendChild(pauseBtn);
      
      app.appendChild(speedDiv);
      
      speedSlider.oninput = function() {
        const level = parseInt(speedSlider.value);
        delay = (11 - level) * 50;
        speedValue.innerText = level;
      };
      
      fixed = new Array(n).fill(false);
      const solution = initialState.slice();
      
      const boardDiv = document.createElement("div");
      boardDiv.id = "boardContainer";
      app.appendChild(boardDiv);
      
      console.log("Phase 3: boardContainer created:", document.getElementById("boardContainer"));
      
      createBoard(n);
      updateBoardDisplay(solution);
      
      const step3BackDiv = document.createElement("div");
      const backBtn = document.createElement("button");
      backBtn.innerText = "Back";
      backBtn.onclick = page3_finalSetup;
      step3BackDiv.appendChild(backBtn);
      app.appendChild(step3BackDiv);
      
      setTimeout(function() {
        backtracking(solution, 0, n);
      }, 500);
    }
    
    function createBoard(N) {
      const boardContainer = document.getElementById("boardContainer");
      boardContainer.innerHTML = "";
      boardContainer.style.display = "grid";
      boardContainer.style.gridTemplateColumns = `repeat(${N}, 60px)`;
      boardContainer.style.width = `${N * 60}px`;
      boardContainer.style.height = `${N * 60}px`;
      boardContainer.className = "board";
      
      cells = [];
      for (let r = 0; r < N; r++) {
        let rowArray = [];
        for (let c = 0; c < N; c++) {
          const cell = document.createElement("div");
          cell.className = "cell";
          cell.style.backgroundColor = ((r + c) % 2 === 0) ? "#ebecd0" : "#789454";
          boardContainer.appendChild(cell);
          rowArray.push(cell);
        }
        cells.push(rowArray);
      }
    }
    
    function updateBoardDisplay(state) {
      for (let r = 0; r < n; r++) {
        for (let c = 0; c < n; c++) {
          const cell = cells[r][c];
          cell.style.backgroundColor = ((r + c) % 2 === 0) ? "#ebecd0" : "#789454";
          cell.innerHTML = "";
        }
        if (state[r] !== -1) {
          const col = state[r];
          const cell = cells[r][col];
          const queenImg = document.createElement("img");
          queenImg.src = "queen.png";
          queenImg.alt = "Queen";
          cell.appendChild(queenImg);
        }
      }
    }
    
    async function backtracking(state, row, N) {
      if (row >= N) {
        if (finalState && !arraysEqual(state, finalState)) {
        } else {
          alert("Solution found!");
          return true;
        }
      }
      
      for (let col = 0; col < N; col++) {
        const cell = cells[row][col];
        const originalColor = ((row + col) % 2 === 0) ? "#ebecd0" : "#789454";
        cell.style.backgroundColor = "yellow";
        await sleepWithPause(delay);
        
        if (isSafe(state, row, col)) {
          state[row] = col;
          updateBoardDisplay(state);
          cell.style.backgroundColor = originalColor;
          await sleepWithPause(delay);
          
          if (await backtracking(state, row + 1, N)) return true;
          
          cell.style.backgroundColor = "red";
          await sleepWithPause(delay);
          state[row] = -1;
          updateBoardDisplay(state);
          cell.style.backgroundColor = originalColor;
          await sleepWithPause(delay);
        } else {
          cell.style.backgroundColor = originalColor;
        }
      }
      return false;
    }
    
    window.onload = page1_initialN;
  </script>
</body>
</html>